{
	"info": {
		"name": "Beetle Quest API",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Player endpoints",
			"item": [
				{
					"name": "Auth",
					"item": [
						{
							"name": "POST /auth/register",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Response should be HTML', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"",
											"if (pm.response.code !== 201) {",
											"   pm.test('Status code is 400', function () {",
											"     pm.response.to.have.status(400);",
											"   });",
											"   pm.test('Response should contain success message in HTML', function () {",
											"       const responseBody = pm.response.text();",
											"       pm.expect(responseBody).to.include('inserted username or mail are already in the system');",
											"   });",
											"} else {",
											"   pm.test('Status code is 201', function () {",
											"     pm.response.to.have.status(201);",
											"   });",
											"   pm.test('Response should contain success message in HTML', function () {",
											"       const responseBody = pm.response.text();",
											"       pm.expect(responseBody).to.include('User registered successfully!');",
											"   });",
											"}"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"let userName = pm.variables.replaceIn(\"{{$randomUserName}}\")",
											"",
											"pm.collectionVariables.set(\"testPasswd\", pm.variables.replaceIn(\"{{$randomPassword}}\"))",
											"pm.collectionVariables.set(\"testUser\", userName)",
											"pm.collectionVariables.set(\"testEmail\", `${userName}@test.it`)",
											"",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\"email\": \"{{testEmail}}\", \"username\": \"{{testUser}}\", \"password\": \"{{testPasswd}}\"}"
								},
								"url": {
									"raw": "{{baseUrl}}/auth/register",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"auth",
										"register"
									]
								}
							},
							"response": []
						},
						{
							"name": "POST /auth/login",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 302\", function () {",
											"    pm.response.to.have.status(302);",
											"});",
											"",
											"pm.test(\"Response time is less than 1000ms\", function () {",
											"    pm.expect(pm.response.responseTime).to.be.below(1000);",
											"});",
											"",
											"pm.test(\"Location header is present\", function () {",
											"    pm.response.to.have.header(\"Location\");",
											"});",
											"",
											"pm.test(\"Set-Cookie header is present\", function () {",
											"    pm.response.to.have.header(\"Set-Cookie\");",
											"    pm.response.cookies.has(\"go_session_id\");",
											"",
											"    pm.collectionVariables.set(\"goSessionCookie\", pm.cookies.get(\"go_session_id\"));",
											"});",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\"username\": \"{{testUser}}\",\"password\": \"{{testPasswd}}\"}"
								},
								"url": {
									"raw": "{{baseUrl}}/auth/login",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"auth",
										"login"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /oauth/authorize",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 302\", function () {",
											"    pm.response.to.have.status(302);",
											"});",
											"",
											"pm.test(\"Retrieve 'code' query parameter from location header\", function () {",
											"    var locationHeader = pm.response.headers.get('Location');",
											"    pm.expect(locationHeader).to.include('code=');",
											"",
											"    var codeValue = locationHeader.split('code=')[1].split('&')[0];",
											"    pm.collectionVariables.set(\"oauthCode\", codeValue);",
											"});",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"followRedirects": false
							},
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{hostUrl}}/oauth/authorize?response_type=code&client_id=beetle-quest&redirect_uri={{oauthCallback}}&scope=user, market, gacha&state={{state}}&code_challenge={{codeChallenge}}&code_challenge_method=S256",
									"host": [
										"{{hostUrl}}"
									],
									"path": [
										"oauth",
										"authorize"
									],
									"query": [
										{
											"key": "response_type",
											"value": "code"
										},
										{
											"key": "client_id",
											"value": "beetle-quest"
										},
										{
											"key": "redirect_uri",
											"value": "{{oauthCallback}}"
										},
										{
											"key": "scope",
											"value": "user, market, gacha"
										},
										{
											"key": "state",
											"value": "{{state}}"
										},
										{
											"key": "code_challenge",
											"value": "{{codeChallenge}}"
										},
										{
											"key": "code_challenge_method",
											"value": "S256"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "POST /oauth/token",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Access token should exist\", function () {",
											"    pm.expect(pm.response.json()).to.have.property('access_token');",
											"",
											"    let access_token = pm.response.json()[\"access_token\"];",
											"    pm.collectionVariables.set(\"accessToken\", access_token);",
											"",
											"    let id_token = pm.response.json()[\"id_token\"];",
											"    pm.collectionVariables.set(\"idToken\", id_token);",
											"",
											"    const base64Url = access_token.split('.')[1];",
											"    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');",
											"    const jsonPayload = JSON.parse(require('atob')(base64));",
											"",
											"    pm.collectionVariables.set(\"testID\", jsonPayload[\"sub\"]);",
											"});",
											"",
											"pm.test(\"Token type should be bearer\", function () {",
											"    pm.expect(pm.response.json().token_type).to.equal('Bearer');",
											"});",
											"",
											"pm.test(\"Scope should include user, market, and gacha\", function () {",
											"    pm.expect(pm.response.json().scope).to.include('user', 'market', 'gacha');",
											"});",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "grant_type",
											"value": "authorization_code",
											"type": "text"
										},
										{
											"key": "code",
											"value": "{{oauthCode}}",
											"type": "text"
										},
										{
											"key": "redirect_uri",
											"value": "{{oauthCallback}}",
											"type": "text"
										},
										{
											"key": "client_id",
											"value": "beetle-quest",
											"type": "text"
										},
										{
											"key": "code_verifier",
											"value": "{{codeVerifier}}",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{hostUrl}}/oauth/token",
									"host": [
										"{{hostUrl}}"
									],
									"path": [
										"oauth",
										"token"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /auth/check_session",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Response status is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/auth/check_session",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"auth",
										"check_session"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /auth/traefik/verify",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Response status is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/auth/traefik/verify",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"auth",
										"traefik",
										"verify"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Static",
					"item": [
						{
							"name": "GET /static/",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function () {",
											"   pm.response.to.have.status(200);",
											"});",
											"pm.test('Response should be HTML', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"pm.test('Response should contain success message in HTML', function () {",
											"    const responseBody = pm.response.text();",
											"    pm.expect(responseBody).to.include(\"check_session\");",
											"    //  pm.expect(responseBody).to.include('Beetle Quest');",
											"    //  pm.expect(responseBody).to.include('Login');",
											"    //  pm.expect(responseBody).to.include('Register');",
											"    //  pm.expect(responseBody).to.include('Admin Login');",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{hostUrl}}/static/",
									"host": [
										"{{hostUrl}}"
									],
									"path": [
										"static",
										""
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Gachas & Market",
					"item": [
						{
							"name": "GET /gacha/list",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Response should be HTML', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"pm.test('Response should contain \"Gacha List\"', function () {",
											"     const responseBody = pm.response.text();",
											"     pm.expect(responseBody).to.include('Gacha List');",
											"});",
											" // Save the ID of one gacha",
											"let regex = /<div class=\"gacha-item Legendary\">[\\s\\S]*?<h3>Druid Butterfly<\\/h3>[\\s\\S]*?<button[^>]*hx-get=\"([^\"]*?)\"[^>]*>Buy<\\/button>/;",
											"let match = pm.response.text().match(regex);",
											"",
											"if (match && match[1]) {",
											"    let requestPath = match[1];",
											"    //console.log('Buy-button request path for Druid Butterfly:', requestPath);",
											"",
											"    let idRegex = /\\/gacha\\/([^\\/]+)\\/buy/;",
											"    let idMatch = requestPath.match(idRegex);",
											"",
											"    if (idMatch && idMatch[1]) {",
											"        let gacha_id = idMatch[1];",
											"        console.log('gachaId:', gacha_id);",
											"        pm.collectionVariables.set('gachaId', gacha_id);",
											"    } else {",
											"        console.log('ID not found in the request path.');",
											"    }",
											"} else {",
											"    console.log('Druid Butterfly not found.');",
											"}"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/gacha/list",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"gacha",
										"list"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /gacha/{{gachaId}}",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Response is JSON', function() {",
											"    pm.response.to.have.jsonBody();",
											"});",
											"",
											"pm.test('Response contains the required fields', function () {",
											"    const jsonData = pm.response.json();",
											"    pm.expect(jsonData).to.have.property('name', 'Druid Butterfly');",
											"    pm.collectionVariables.set('gachaName', 'Druid Butterfly')",
											"    pm.expect(jsonData).to.have.property('rarity', 'Legendary');",
											"    pm.expect(jsonData).to.have.property('price', 30000);",
											"    pm.expect(jsonData).to.have.property('image_path', '/static/images/druid_butterfly_legendary.webp');",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/gacha/{{gachaId}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"gacha",
										"{{gachaId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "POST /market/bugscoin/buy",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('heck for successful return code', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"",
											"pm.test('Check if response contains Bugscoin added successfully', function () {",
											"    pm.expect(pm.response.text()).to.include('Bugscoin added successfully');",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\"amount\": \"100000\"}"
								},
								"url": {
									"raw": "{{baseUrl}}/market/bugscoin/buy",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"bugscoin",
										"buy"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /market/gacha/{gachaId}/buy",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('heck for successful return code', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"",
											"pm.test('Check if response contains Gacha bought successfully', function () {",
											"    pm.expect(pm.response.text()).to.include('Gacha bought successfully');",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/market/gacha/{{gachaId}}/buy",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"gacha",
										"{{gachaId}}",
										"buy"
									]
								}
							},
							"response": []
						},
						{
							"name": "POST /market/auction",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"let now = new Date();",
											"now.setHours(now.getHours() + 3);",
											"// Format the date to YYYY-MM-DDTHH:mm",
											"pm.collectionVariables.set('auctionTime', now.toISOString().slice(0, 16));",
											"//console.log(pm.collectionVariables.get('auctionTime'));"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Check for successful return code', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"",
											"pm.test('Check if response contains Account Market Gachas and Logout', function () {",
											"    pm.expect(pm.response.text()).to.include('Auction created successfully');",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\"gacha_id\":\"{{gachaId}}\",\"end_time\":\"{{auctionTime}}\"}"
								},
								"url": {
									"raw": "{{baseUrl}}/market/auction/",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"auction",
										""
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /market/auction/list",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('heck for successful return code', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"",
											"pm.test('Check if response contains Roll Gacha', function () {",
											"    pm.expect(pm.response.text()).to.include('Roll Gacha');",
											"});",
											"",
											"pm.test('Gacha name found in the auction list', function () {",
											"    const gachaString = `<p>Gacha: ${pm.collectionVariables.get('gachaName')}</p>`;",
											"    let gachaFound = pm.response.text().includes(gachaString);",
											"    pm.expect(gachaFound).to.be.true;",
											"});",
											"",
											"const auctionIdRegex = /Auction ID: ([\\w-]+)/;",
											"const match = pm.response.text().match(auctionIdRegex);",
											"if (match && match[1]) {",
											"    const auctionId = match[1];",
											"    //console.log(`Extracted Auction ID: ${auctionId}`);",
											"    pm.collectionVariables.set('auctionId', auctionId);",
											"} else {",
											"    console.log('Auction ID not found.');",
											"}"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/market/auction/list",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"auction",
										"list"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /market/auction/{{auctionId}}",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Check for successful return code', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"pm.test('Check if response contains Roll Gacha', function () {",
											"    pm.expect(pm.response.text()).to.include('Auction Details');",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/market/auction/{{auctionId}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"auction",
										"{{auctionId}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "POST /market/auction/{auctionId}/bid",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"// TODO: test buy action from other user ",
											"pm.test('Check for 400 return code', function () {",
											"    pm.response.to.have.status(400);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"pm.test('Check if response contains', function () {",
											"    pm.expect(pm.response.text()).to.include('owner cannot bid');",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\"bid_amount\": \"10000\"}"
								},
								"url": {
									"raw": "{{baseUrl}}/market/auction/{{auctionId}}/bid",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"auction",
										"{{auctionId}}",
										"bid"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /gacha/user/{testID}/list",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"  pm.response.to.have.status(200);",
											"});",
											"pm.test('Response should be JSON', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
											"});",
											"pm.test('Response should contain user gacha list', function () {",
											"   var jsonData = pm.response.json();",
											"   var expectedItem = {",
											"       name: 'Druid Butterfly',",
											"       rarity: 4,",
											"       price: 30000,",
											"       image_path: '/static/images/druid_butterfly_legendary.webp'",
											"   };",
											"   var itemFound = jsonData.some(function(item) {",
											"       return item.name === expectedItem.name &&",
											"              item.rarity === expectedItem.rarity &&",
											"              item.price === expectedItem.price &&",
											"              item.image_path === expectedItem.image_path;",
											"   });",
											"   pm.expect(itemFound).to.be.true;",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/gacha/user/{{testID}}/list",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"gacha",
										"user",
										"{{testID}}",
										"list"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /gacha/{{gachaId}}/user/{{testID}}",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"  pm.response.to.have.status(200);",
											"});",
											"pm.test('Response should be JSON', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
											"});",
											"pm.test('Response should contain gacha details', function () {",
											"    const jsonData = pm.response.json();",
											"    pm.expect(jsonData).to.have.property('name', pm.collectionVariables.get('gachaName'));",
											"    pm.expect(jsonData).to.have.property('rarity', 4);",
											"    pm.expect(jsonData).to.have.property('price', 30000);",
											"    pm.expect(jsonData).to.have.property('image_path', '/static/images/druid_butterfly_legendary.webp');",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/gacha/{{gachaId}}/user/{{testID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"gacha",
										"{{gachaId}}",
										"user",
										"{{testID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "GET /market/gacha/roll",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('heck for successful return code', function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test('Check if response is in HTML format', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"",
											"pm.test('Check if response contains Account Market Gachas and Logout', function () {",
											"    pm.expect(pm.response.text()).to.include('Gacha successfully obtained, check your inventory!');",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/market/gacha/roll",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"market",
										"gacha",
										"roll"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Users",
					"item": [
					{
						"name": "GET /userinfo",
						"event": [
							{
								"listen": "test",
								"script": {
									"type": "text/javascript",
									"exec": [
										"pm.test('Status code is 200', function () {",
										"  pm.response.to.have.status(200);",
										"});",
										"pm.test('Response should be JSON', function () {",
										"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
										"});",
										"console.log(pm.response.text());",
										"pm.test('Response should contain success message in JSON', function () {",
										"    const responseBody = pm.response.text();",
										"    pm.expect(responseBody).to.include('currency');",
										"});"
									]
								}
							}
						],
						"request": {
							"method": "GET",
							"header": [],
							"url": {
								"raw": "{{hostUrl}}/userinfo",
								"host": ["{{hostUrl}}"],
								"path": ["userinfo"]
							}
						}
					},
						{
							"name": "GET /user/account/{{testID}}",
							"event": [
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											"pm.test('Status code is 200', function () {",
											"  pm.response.to.have.status(200);",
											"});",
											"pm.test('Response should be HTML', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"pm.test('Response should contain success message in HTML', function () {",
											"    const responseBody = pm.response.text();",
											"    pm.expect(responseBody).to.include('Own gachas');",
											"});"
										]
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/user/account/{{testID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"user",
										"account",
										"{{testID}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "PATCH /user/account/{{testID}}",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test('Status code is 200', function () {",
											"  pm.response.to.have.status(200);",
											"});",
											"pm.test('Response should be HTML', function () {",
											"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
											"});",
											"pm.test('Response should contain success message in HTML', function () {",
											"    const responseBody = pm.response.text();",
											"    pm.expect(responseBody).to.include('User account updated successfully');",
											"});"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"let userName = pm.variables.replaceIn(\"{{$randomUserName}}\")",
											"",
											"pm.collectionVariables.set(\"newTestPasswd\", pm.variables.replaceIn(\"{{$randomPassword}}\"))",
											"pm.collectionVariables.set(\"newTestUser\", userName)",
											"pm.collectionVariables.set(\"newTestEmail\", `${userName}@test.it`)",
											"",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "PATCH",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\"username\": \"{{newTestUser}}\",\"email\": \"{{newTestEmail}}\",\"new_password\": \"{{newTestPasswd}}\",\"old_password\": \"{{testPasswd}}\"}"
								},
								"url": {
									"raw": "{{baseUrl}}/user/account/{{testID}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"user",
										"account",
										"{{testID}}"
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "Admin endpoints",
			"item": [
				{
					"name": "POST /auth/admin/login",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"admin_id\": \"09087f45-5209-4efa-85bd-761562a6df53\",\n    \"password\": \"admin\",\n    \"otp_code\": \"{{otpCode}}\"}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/auth/admin/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"auth",
								"admin",
								"login"
							]
						}
					},
					"event": [
					  {
					  	"listen": "prerequest",
					  	"script": {
					  		"exec": [
									"// TODO: export old session",
									"pm.cookies.jar().clear(pm.collectionVariables.get('baseUrl'), console.log);"
					  		],
					  		"type": "text/javascript",
					  		"packages": {}
					  	}
					  },
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// BASE 32 RFC 4648 compliant",
									"const alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";",
									"const secret = pm.collectionVariables.get(\"otpSecret\");",
									"",
									"require('crypto-js').enc.u8array = {",
									"  /**",
									"   * Converts a word array to a Uint8Array.",
									"   *",
									"   * @param {WordArray} wordArray The word array.",
									"   *",
									"   * @return {Uint8Array} The Uint8Array.",
									"   *",
									"   * @static",
									"   *",
									"   * @example",
									"   *",
									"   *     var u8arr = CryptoJS.enc.u8array.stringify(wordArray);",
									"   */",
									"  stringify: function (wordArray) {",
									"    // Shortcuts",
									"    var words = wordArray.words;",
									"    var sigBytes = wordArray.sigBytes;",
									"",
									"    // Convert",
									"    var u8 = new Uint8Array(sigBytes);",
									"    for (var i = 0; i < sigBytes; i++) {",
									"      var byte = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;",
									"      u8[i] = byte;",
									"    }",
									"",
									"    return u8;",
									"  },",
									"",
									"  /**",
									"   * Converts a Uint8Array to a word array.",
									"   *",
									"   * @param {string} u8Str The Uint8Array.",
									"   *",
									"   * @return {WordArray} The word array.",
									"   *",
									"   * @static",
									"   *",
									"   * @example",
									"   *",
									"   *     var wordArray = CryptoJS.enc.u8array.parse(u8arr);",
									"   */",
									"  parse: function (u8arr) {",
									"    // Shortcut",
									"    var len = u8arr.length;",
									"",
									"    // Convert",
									"    var words = [];",
									"    for (var i = 0; i < len; i++) {",
									"      words[i >>> 2] |= (u8arr[i] & 0xff) << (24 - (i % 4) * 8);",
									"    }",
									"",
									"    return require('crypto-js').lib.WordArray.create(words, len);",
									"  },",
									"};",
									"",
									"function readChar (char) {",
									"  var idx = alphabet.indexOf(char)",
									"  if (idx === -1) {",
									"    throw new Error('Invalid character found: ' + char)",
									"  }",
									"  return idx",
									"}",
									"",
									"function decode(input) {",
									"  let length = input.length;",
									"  const leftover = (length * 5) % 8;",
									"  const offset = leftover === 0 ? 0 : 8 - leftover;",
									"  let bits = 0, value = 0, index = 0;",
									"  var output = new Uint8Array(Math.ceil((length * 5) / 8));",
									"  for (var i = 0; i < length; i++) {",
									"    value = (value << 5) | readChar(input[i]);",
									"    bits += 5;",
									"    if (bits >= 8) {",
									"      output[index++] = (value >>> (bits + offset - 8)) & 255;",
									"      bits -= 8;",
									"    }",
									"  }",
									"  if (bits > 0) {",
									"    output[index] = (value << (bits + offset - 8)) & 255;",
									"  }",
									"  if (leftover !== 0) {",
									"    output = output.slice(1);",
									"  }",
									"  return output;",
									"}",
									"",
									"const truncate = (digest) => {",
									"  const offset = digest[19] & 0xf; // last 4 bits",
									"",
									"  // take 4 bytes starting at the specified byte offset,",
									"  // but chop off the first bit so we have only 31 bits",
									"  const v =",
									"    ((digest[offset] & 0x7f) << 24) + // 0x7F = 01111111",
									"    (digest[offset + 1] << 16) +",
									"    (digest[offset + 2] << 8) +",
									"    digest[offset + 3];",
									"",
									"  return (v % 10**6).toString(10).padStart(6, \"0\");",
									"};",
									"",
									"const cryptoJSTotp = (interval, secret) => {",
									"  let digest = require('crypto-js').HmacSHA1(require('crypto-js').enc.Hex.parse(interval), require('crypto-js').enc.u8array.parse(decode(secret))).toString(require('crypto-js').enc.u8array);",
									"  return truncate(digest);",
									"};",
									"",
									"// current time, in seconds since the Unix epoch",
									"const time = Math.floor(new Date().getTime() / 1000);",
									"",
									"// how many 30-second intervals AND pad to 8 bytes = 16 hex characters",
									"const interval = Math.floor(time / 30)",
									"  .toString(16)",
									"  .padStart(16, \"0\");",
									"",
									"const otp = cryptoJSTotp(interval, secret);",
									"pm.collectionVariables.set(\"otpCode\", otp);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Response time is less than 150ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(150);",
									"});",
									"",
									"pm.test(\"Location header is present\", function () {",
									"    pm.response.to.have.header(\"Location\");",
									"});",
									"pm.test(\"Set-Cookie header is present\", function () {",
									"    pm.response.to.have.header(\"Set-Cookie\");",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					]
				},
				{
					"name": "GET /oauth/authorize",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Retrieve 'code' query parameter from location header\", function () {",
									"    var locationHeader = pm.response.headers.get('Location');",
									"    pm.expect(locationHeader).to.include('code=');",
									"",
									"    var codeValue = locationHeader.split('code=')[1].split('&')[0];",
									"    pm.collectionVariables.set(\"oauthCode\", codeValue);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"followRedirects": false
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{hostUrl}}/oauth/authorize?response_type=code&client_id=beetle-quest&redirect_uri={{oauthCallback}}&scope=admin&state={{state}}&code_challenge={{codeChallenge}}&code_challenge_method=S256",
							"host": [
								"{{hostUrl}}"
							],
							"path": [
								"oauth",
								"authorize"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "beetle-quest"
								},
								{
									"key": "redirect_uri",
									"value": "{{oauthCallback}}"
								},
								{
									"key": "scope",
									"value": "admin"
								},
								{
									"key": "state",
									"value": "{{state}}"
								},
								{
									"key": "code_challenge",
									"value": "{{codeChallenge}}"
								},
								{
									"key": "code_challenge_method",
									"value": "S256"
								}
							]
						}
					}
				},
				{
					"name": "POST /oauth/token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Access token should exist\", function () {",
									"    pm.expect(pm.response.json()).to.have.property('access_token');",
									"",
									"    let access_token = pm.response.json()[\"access_token\"];",
									"    pm.collectionVariables.set(\"accessToken\", access_token);",
									"",
									"    let id_token = pm.response.json()[\"id_token\"];",
									"    pm.collectionVariables.set(\"idToken\", id_token);",
									"});",
									"",
									"pm.test(\"Token type should be bearer\", function () {",
									"    pm.expect(pm.response.json().token_type).to.equal('Bearer');",
									"});",
									"",
									"pm.test(\"Scope should include admin\", function () {",
									"    pm.expect(pm.response.json().scope).to.include('admin');",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "grant_type",
									"value": "authorization_code",
									"type": "text"
								},
								{
									"key": "code",
									"value": "{{oauthCode}}",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "{{oauthCallback}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "beetle-quest",
									"type": "text"
								},
								{
									"key": "code_verifier",
									"value": "{{codeVerifier}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{hostUrl}}/oauth/token",
							"host": [
								"{{hostUrl}}"
							],
							"path": [
								"oauth",
								"token"
							]
						}
					}
				},
				{
					"name": "GET /admin/user/get_all",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test for status code",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Test for response time",
									"pm.test(\"Response time is less than 500ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.lessThan(500);",
									"});",
									"",
									"// Test for response body properties",
									"pm.test(\"Response body has UserList property\", function () {",
									"    pm.expect(pm.response.json()).to.have.property('UserList');",
									"});",
									"",
									"pm.test(\"UserList contains user_id, username, email, currency, and password_hash\", function () {",
									"    var userList = pm.response.json().UserList[0];",
									"    pm.expect(userList).to.have.property('user_id');",
									"    pm.expect(userList).to.have.property('username');",
									"    pm.expect(userList).to.have.property('email');",
									"    pm.expect(userList).to.have.property('currency');",
									"    pm.expect(userList).to.have.property('password_hash');",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/user/get_all",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"admin",
								"user",
								"get_all"
							]
						}
					}
				},
				{
					"name": "GET /admin/user/{{testID}}",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test(\"User details obtained successfully\", function () {",
									"    pm.expect(pm.response.json()).to.have.property('User');",
									"});",
									"",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/user/{{testID}}",
							"host": ["{{baseUrl}}"],
							"path": ["admin","user","{{testID}}"]
						}
					}
				},
				{
					"name": "PATCH (Update) /admin/user/{{testID}} ",
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\"username\": \"Bob2\",\"email\": \"bob2@test.com\",\"currency\": \"100000\"}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/admin/user/{{testID}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": ["admin","user","{{testID}}"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
								"console.log( pm.response.text() );",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test(\"User profile updated successfully\", function () {",
									"    pm.expect(pm.response.text()).to.include(\"User profile updated successfully!\");",
									"});",
									"pm.collectionVariables.set(\"testUser\", 'Bob2');",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					]
				},
				{
					"name": "GET /admin/user/{{testID}}/transaction_history",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/user/{{testID}}/transaction_history",
							"host": ["{{baseUrl}}"],
							"path": ["admin","user","{{testID}}","transaction_history"]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test(\"Response body has TransactionList as an array\", function () {",
									"    const responseBody = pm.response.json();",
									"    pm.expect(responseBody).to.be.an('object'); // Verifica che il corpo sia un oggetto",
									"    pm.expect(responseBody).to.have.property('TransactionList'); // Verifica che esista la proprietÃ  TransactionList",
									"    pm.expect(responseBody.TransactionList).to.be.an('array'); // Verifica che TransactionList sia un array",
									"});",
									"",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					]
				},
				{
					"name": "GET /admin/user/{{testID}}/auction/get_all",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/user/{{testID}}/auction/get_all",
							"host": ["{{baseUrl}}"],
							"path": ["admin","user","{{testID}}","auction","get_all"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test(\"Response body is not empty\", function () {",
									"    pm.expect(pm.response.json()).to.not.be.empty;",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					]
				},
				{
					"name": "POST /admin/gacha/add",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"pm.test(\"Gacha added successfully\", function () {",
									"    const responseBody = pm.response.text(); // Ottieni il corpo della risposta come testo",
									"    pm.expect(responseBody).to.include('Gacha added successfully!');",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Generate a random UUID for gacha_id",
									"const { v4: uuidv4 } = require('uuid');",
									"",
									"const uuid = uuidv4();",
									"pm.globals.set('createGachaId', uuid);",
									"const byteArray = uuid.replace(/-/g, '').match(/.{1,2}/g).map(hex => parseInt(hex, 16));",
									"pm.globals.set('createGachaIdByteArray', JSON.stringify(byteArray));",
									"",
									"// Generate a random gacha name",
									"const adjectives = ['Lucky', 'Mystic', 'Radiant', 'Golden', 'Silver', 'Crimson', 'Azure', 'Cosmic', 'Legendary', 'Epic'];",
									"const nouns = ['Dragon', 'Phoenix', 'Knight', 'Wizard', 'Warrior', 'Star', 'Gem', 'Guardian', 'Spirit', 'Hero'];",
									"",
									"const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];",
									"const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];",
									"pm.environment.set('createGachaName', `\"${randomAdjective} ${randomNoun}\"`);",
									"",
									"// Generate a random price between 100 and 1000",
									"const randomPrice = Math.floor(Math.random() * 901) + 100;",
									"pm.environment.set('createGachaPrice', randomPrice);",
									"",
									"// Generate a random image name",
									"const imagePrefix = ['item', 'gacha', 'character', 'weapon', 'artifact'];",
									"const randomPrefix = imagePrefix[Math.floor(Math.random() * imagePrefix.length)];",
									"const randomId = Math.floor(Math.random() * 1000).toString().padStart(3, '0');",
									"pm.environment.set('createGachaImageName', `${randomPrefix}_${randomId}`);",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\"name\": {{createGachaName}},\"rarity\": \"Common\",\"price\": \"2000\",\"image_path\": \"/images/gacha/{{createGachaImageName}}.png\"}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/admin/gacha/add",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"admin",
								"gacha",
								"add"
							]
						}
					}
				},
				{
					"name": "GET /admin/gacha/get_all",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test(\"Response body is not empty\", function () {",
									"    pm.expect(pm.response.json()).to.not.be.empty;",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"const jsonResponse = JSON.parse(pm.response.text());",
									"pm.globals.set('GachaId', jsonResponse.GachaList[0].gacha_id);",
									"// console.log(pm.globals.get('GachaId'));",
									"pm.globals.set('newGachaId', jsonResponse.GachaList[1].gacha_id);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/gacha/get_all",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"admin",
								"gacha",
								"get_all"
							]
						}
					}
				},
				{
					"name": "GET /admin/gacha/{{gachaId}}",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test for status code",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// Test for response time",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/gacha/{{gachaId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"admin",
								"gacha",
								"{{gachaId}}"
							]
						}
					}
				},
				{
					"name": "PATCH /admin/gacha/{{gachaId}}",
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\"name\": \"Mage Mosquito4\",\"rarity\": \"Rare\",\"price\": \"500\",\"image_path\": \"/images/mage_mosquito_uncommon.png\"}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/admin/gacha/{{gachaId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"admin",
								"gacha",
								"{{gachaId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test for successful PATCH request",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.lessThan(200);",
									"});",
									"",
									"pm.test(\"Response body does not contain error message\", function () {",
									"    pm.expect(pm.response.text()).to.not.include(\"error\");",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					]
				},
				{
				  "name": "GET /admin/market/transaction_history",
				  "event": [
				    {
				      "listen": "test",
				      "script": {
				      "exec": [
	   			  	  "pm.test(\"Status code is 200\", function () {",
	   			  	  "    pm.response.to.have.status(200);",
	   			  	  "});",
	   			  	  "",
	   			  	  "pm.test(\"Response time is less than 200ms\", function () {",
	   			  	  "    pm.expect(pm.response.responseTime).to.be.below(200);",
	   			  	  "});",
	   			  	  "",
	   			  	  "pm.test(\"MarketHistory exists\", () => {",
	   			  	  "    const jsonData = pm.response.json(); ",
	   			  	  "    pm.expect(jsonData).to.have.property(\"MarketHistory\"); ",
	   			  	  "    pm.expect(jsonData.MarketHistory).to.be.not.null; ",
	   			  	  "});"
				      ],
				      "type": "text/javascript",
				      "packages": {}
							}
				    }
				  ],
					"request": {
				    "method": "GET",
						"header": [],
						"url": {
						  "raw": "{{baseUrl}}/admin/market/transaction_history",
							"host": ["{{baseUrl}}"],
							"path": ["admin","market","transaction_history"]
				    }
					}
				},
				{
					"name": "GET /admin/market/auction/get_all",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test(\"All auction obtained successfully\", () => {",
									"    const jsonData = pm.response.json(); ",
									"",
									"    // Check if the 'AuctionList' property exists",
									"    pm.expect(jsonData).to.have.property(\"AuctionList\");",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/market/auction/get_all",
							"host": ["{{baseUrl}}"],
							"path": ["admin","market","auction","get_all"]
						}
					}
				},
				{
					"name": "GET /admin/market/auction/{{auctionId}}",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(200);",
									"});",
									"",
									"pm.test('Response is JSON', function () {",
									"    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/admin/market/auction/{{auctionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["admin","market","auction","{{auctionId}}"]
						}
					}
				},
				{
					"name": "PATCH /admin/market/auction/{{auctionId}}",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response time is less than 200ms\", function () {",
									"    pm.expect(pm.response.responseTime).to.be.lessThan(200);",
									"});",
									"",
									"pm.test(\"Response body does not contain error message\", function () {",
									"    pm.expect(pm.response.text()).to.not.include(\"error\");",
									"});"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\"gacha_id\": \"{{gachaId}}\"}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/admin/market/auction/{{auctionId}}",
							"host": ["{{baseUrl}}"],
							"path": ["admin","market","auction","{{auctionId}}"]
						}
					}
				}
			]
		},
		{
		  "name": "Closing endpoints",
			"item":[
			{
				"name": "POST /auth/login",
				"event": [
		      {
		      	"listen": "prerequest",
		      	"script": {
		      		"exec": [
				   			"pm.cookies.jar().clear(pm.collectionVariables.get('baseUrl'), console.log);"
		      		],
		      		"type": "text/javascript",
		      		"packages": {}
		      	}
		      },
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Status code is 302\", function () {",
								"    pm.response.to.have.status(302);",
								"});",
								"",
								"pm.test(\"Response time is less than 1000ms\", function () {",
								"    pm.expect(pm.response.responseTime).to.be.below(1000);",
								"});",
								"",
								"pm.test(\"Location header is present\", function () {",
								"    pm.response.to.have.header(\"Location\");",
								"});",
								"",
								"pm.test(\"Set-Cookie header is present\", function () {",
								"    pm.response.to.have.header(\"Set-Cookie\");",
								"    pm.response.cookies.has(\"go_session_id\");",
								"",
								"    pm.collectionVariables.set(\"goSessionCookie\", pm.cookies.get(\"go_session_id\"));",
								"});",
								""
							],
							"type": "text/javascript",
							"packages": {}
						}
					}
				],
				"request": {
					"auth": {
						"type": "noauth"
					},
					"method": "POST",
					"header": [],
					"body": {
						"mode": "raw",
						"raw": "{\"username\": \"Bob2\",\"password\": \"{{newTestPasswd}}\"}"
					},
					"url": {
						"raw": "{{baseUrl}}/auth/login",
						"host": [
							"{{baseUrl}}"
						],
						"path": [
							"auth",
							"login"
						]
					}
				},
				"response": []
			},
			{
				"name": "GET /oauth/authorize",
				"event": [
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Status code is 302\", function () {",
								"    pm.response.to.have.status(302);",
								"});",
								"",
								"pm.test(\"Retrieve 'code' query parameter from location header\", function () {",
								"    var locationHeader = pm.response.headers.get('Location');",
								"    pm.expect(locationHeader).to.include('code=');",
								"",
								"    var codeValue = locationHeader.split('code=')[1].split('&')[0];",
								"    pm.collectionVariables.set(\"oauthCode\", codeValue);",
								"});",
								""
							],
							"type": "text/javascript",
							"packages": {}
						}
					}
				],
				"protocolProfileBehavior": {
					"followRedirects": false
				},
				"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{hostUrl}}/oauth/authorize?response_type=code&client_id=beetle-quest&redirect_uri={{oauthCallback}}&scope=user, market, gacha&state={{state}}&code_challenge={{codeChallenge}}&code_challenge_method=S256",
						"host": [
							"{{hostUrl}}"
						],
						"path": [
							"oauth",
							"authorize"
						],
						"query": [
							{
								"key": "response_type",
								"value": "code"
							},
							{
								"key": "client_id",
								"value": "beetle-quest"
							},
							{
								"key": "redirect_uri",
								"value": "{{oauthCallback}}"
							},
							{
								"key": "scope",
								"value": "user, market, gacha"
							},
							{
								"key": "state",
								"value": "{{state}}"
							},
							{
								"key": "code_challenge",
								"value": "{{codeChallenge}}"
							},
							{
								"key": "code_challenge_method",
								"value": "S256"
							}
						]
					}
				},
				"response": []
			},
			{
				"name": "POST /oauth/token",
				"event": [
					{
						"listen": "test",
						"script": {
							"exec": [
								"pm.test(\"Access token should exist\", function () {",
								"    pm.expect(pm.response.json()).to.have.property('access_token');",
								"",
								"    let access_token = pm.response.json()[\"access_token\"];",
								"    pm.collectionVariables.set(\"accessToken\", access_token);",
								"",
								"    let id_token = pm.response.json()[\"id_token\"];",
								"    pm.collectionVariables.set(\"idToken\", id_token);",
								"",
								"    const base64Url = access_token.split('.')[1];",
								"    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');",
								"    const jsonPayload = JSON.parse(require('atob')(base64));",
								"",
								"    pm.collectionVariables.set(\"testID\", jsonPayload[\"sub\"]);",
								"});",
								"",
								"pm.test(\"Token type should be bearer\", function () {",
								"    pm.expect(pm.response.json().token_type).to.equal('Bearer');",
								"});",
								"",
								"pm.test(\"Scope should include user, market, and gacha\", function () {",
								"    pm.expect(pm.response.json().scope).to.include('user', 'market', 'gacha');",
								"});",
								""
							],
							"type": "text/javascript",
							"packages": {}
						}
					}
				],
				"request": {
					"method": "POST",
					"header": [],
					"body": {
						"mode": "formdata",
						"formdata": [
							{
								"key": "grant_type",
								"value": "authorization_code",
								"type": "text"
							},
							{
								"key": "code",
								"value": "{{oauthCode}}",
								"type": "text"
							},
							{
								"key": "redirect_uri",
								"value": "{{oauthCallback}}",
								"type": "text"
							},
							{
								"key": "client_id",
								"value": "beetle-quest",
								"type": "text"
							},
							{
								"key": "code_verifier",
								"value": "{{codeVerifier}}",
								"type": "text"
							}
						]
					},
					"url": {
						"raw": "{{hostUrl}}/oauth/token",
						"host": [
							"{{hostUrl}}"
						],
						"path": [
							"oauth",
							"token"
						]
					}
				},
				"response": []
			},
			  {
			  	"name": "POST (DELETE) /market/auction/{{auctionId}}",
			  	"request": {
			  		"method": "POST",
			  		"header": [],
			  		"body":{
			        "mode": "raw",
			  			"raw": "{\"password\": \"{{newTestPasswd}}\" }"
			  		},
			  		"url": {
			  			"raw": "{{baseUrl}}/market/auction/{{auctionId}}",
			  			"host": [
			  				"{{baseUrl}}"
			  			],
			  			"path": [
			  				"market",
			  				"auction",
			  				"{{auctionId}}"
			  			]
			  		}
			  	},
			  	"event": [
			  		{
			  			"listen": "test",
			  			"script": {
			  				"type": "text/javascript",
			  				"exec": [
			  					"pm.test('Check for successful return code', function () {",
			  					"    pm.response.to.have.status(200);",
			  					"});",
			  					"",
			  					"pm.test('Check if response is in HTML format', function () {",
			  					"    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
			  					"});",
			  					"pm.test('Check if response contains Auction deleted successfully', function () {",
			  					"    pm.expect(pm.response.text()).to.include('Auction deleted successfully');",
			  					"});"
			  				]
			  			}
			  		}
			  	]
			  },
			  {
					"name": "POST (DELETE) /user/account/{{testID}}",
					"request": {
					"method": "POST",
					"header": [],
					"body": {
					  "mode": "raw",
						"raw": "{\"password\": \"{{newTestPasswd}}\"}"
					},
					"url": {
						"raw": "{{baseUrl}}/user/account/{{testID}}",
						"host": [
							"{{baseUrl}}"
						],
						"path": [
							"user",
							"account",
							"{{testID}}"
						]
					}
					},
					"event": [
					{
						"listen": "test",
						"script": {
							"type": "text/javascript",
							"exec": [
								"pm.test('Status code is 303', function () {",
								"    pm.response.to.have.status(303);",
								"});",
								"",
								"// pm.test('Response should be HTML', function () {",
								"//     pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
								"// });",
								"// pm.test('Response should contain success message in HTML', function () {",
								"//      const responseBody = pm.response.text();",
								"//      pm.expect(responseBody).to.include('Beetle Quest');",
								"//      pm.expect(responseBody).to.include('Login');",
								"//      pm.expect(responseBody).to.include('Register');",
								"//      pm.expect(responseBody).to.include('Admin Login');",
								"// });"
							]
						}
					}
			  	]
			  },
			  {
			  	"name": "GET /auth/logout",
			  	"event": [
					{
						"listen": "test",
						"script": {
							"type": "text/javascript",
							"exec": [
								"pm.test('Response status is 302', function () {",
								"    pm.response.to.have.status(302);",
								"});",
								"",
								"pm.test(\"Response is HTML\", function () {",
								"    pm.expect(pm.response.headers.get('content-type')).to.include('text/html');",
								"});",
								""
							]
						}
					}
			  	],
			  	"request": {
					"method": "GET",
					"header": [],
					"url": {
						"raw": "{{baseUrl}}/auth/logout",
						"host": [
							"{{baseUrl}}"
						],
						"path": [
							"auth",
							"logout"
						]
					}
			  	}
			  }
			]
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{accessToken}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "https://reverse-proxy/api/v1",
			"type": "string"
		},
		{
			"key": "hostUrl",
			"value": "https://reverse-proxy",
			"type": "string"
		},
		{
			"key": "oauthCallback",
			"value": "/fake/callback",
			"type": "default"
		},
		{
			"key": "state",
			"value": "1010010",
			"type": "string"
		},
		{
			"key": "codeVerifier",
			"value": "8f4a95a8a9ebdbecb0781bb24580b64eb02ed3d4d025182c93d19a97",
			"type": "string"
		},
		{
			"key": "codeChallenge",
			"value": "9Qcei7HNb5d1lxXWmxR-t9WboKImV_cJjcoQoxVCPJY",
			"type": "string"
		},
		{
			"key": "otpSecret",
			"value": "G2YTWH764PX5WZORXCBK2C2F2JHV74KD",
			"type": "string"
		},
		{
			"key": "goSessionCookie",
			"value": "",
			"type": "string"
		},
		{
			"key": "oauthCode",
			"value": "",
			"type": "default"
		},
		{
			"key": "accessToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "idToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "testUser",
			"value": "",
			"type": "string"
		},
		{
			"key": "testEmail",
			"value": "",
			"type": "string"
		},
		{
			"key": "testPasswd",
			"value": "",
			"type": "string"
		},
		{
			"key": "testID",
			"value": ""
		},
		{
			"key": "gachaId",
			"value": ""
		},
		{
			"key": "gachaName",
			"value": ""
		},
		{
			"key": "auctionTime",
			"value": ""
		},
		{
			"key": "auctionId",
			"value": ""
		},
		{
			"key": "newTestPasswd",
			"value": ""
		},
		{
			"key": "newTestUser",
			"value": ""
		},
		{
			"key": "newTestEmail",
			"value": ""
		},
		{
			"key": "otpCode",
			"value": ""
		},
		{
			"key": "newGachaIdByteArray",
			"value": "[150, 248, 206, 212, 3, 5, 67, 173, 158, 82, 119, 144, 19, 250, 133, 2]",
			"type": "string"
		},
		{
			"key": "newGachaId",
			"value": "",
			"type": "string"
		}
	]
}
